ğŸ”¹ Tá»•ng quan Dá»± Ã¡n HANOIGO

HANOIGO lÃ  má»™t ná»n táº£ng web há»— trá»£ tÃ¬m kiáº¿m vÃ  khÃ¡m phÃ¡ Ä‘á»‹a Ä‘iá»ƒm Äƒn uá»‘ng, vui chÆ¡i táº¡i HÃ  Ná»™i, hÆ°á»›ng Ä‘áº¿n ngÆ°á»i dÃ¹ng tráº» cÃ³ nhu cáº§u tráº£i nghiá»‡m theo cÃ¡ch cÃ¡ nhÃ¢n hÃ³a vÃ  linh hoáº¡t.

ğŸ¯ Váº¥n Ä‘á» Ä‘áº·t ra

CÃ¡c ná»n táº£ng hiá»‡n táº¡i chá»§ yáº¿u dá»±a vÃ o bá»™ lá»c tÄ©nh, khiáº¿n ngÆ°á»i dÃ¹ng:

Máº¥t nhiá»u thá»i gian tÃ¬m kiáº¿m

KhÃ³ diá»…n Ä‘áº¡t nhu cáº§u theo ngá»¯ cáº£nh (tÃ¢m tráº¡ng, má»¥c Ä‘Ã­ch, ngÃ¢n sÃ¡ch)

Nháº­n gá»£i Ã½ chÆ°a Ä‘á»§ â€œÄ‘Ãºng guâ€

ğŸ’¡ Giáº£i phÃ¡p cá»§a HANOIGO

HANOIGO káº¿t há»£p tÃ¬m kiáº¿m truyá»n thá»‘ng vÃ  AI Chatbot thÃ´ng minh (RAG), cho phÃ©p:

TÃ¬m Ä‘á»‹a Ä‘iá»ƒm báº±ng ngÃ´n ngá»¯ tá»± nhiÃªn

Gá»£i Ã½ dá»±a trÃªn sá»Ÿ thÃ­ch cÃ¡ nhÃ¢n + ngá»¯ cáº£nh truy váº¥n

LiÃªn tá»¥c cáº£i thiá»‡n cháº¥t lÆ°á»£ng gá»£i Ã½ nhá» vÃ²ng láº·p pháº£n há»“i tá»« ngÆ°á»i dÃ¹ng

âš™ï¸ Kiáº¿n trÃºc & CÃ´ng nghá»‡

MERN Stack: MongoDB, Express.js, React, Node.js

AI Chatbot: OpenAI API + Retrieval-Augmented Generation (RAG)

Database NoSQL (MongoDB): linh hoáº¡t, phÃ¹ há»£p dá»¯ liá»‡u ngá»¯ nghÄ©a

Cloud Storage: Cloudinary

Authentication: JWT

ğŸ‘¥ Äá»‘i tÆ°á»£ng sá»­ dá»¥ng

NgÆ°á»i dÃ¹ng (End-User):

TÃ¬m kiáº¿m Ä‘á»‹a Ä‘iá»ƒm thá»§ cÃ´ng hoáº·c qua AI Chatbot

Xem chi tiáº¿t Ä‘á»‹a Ä‘iá»ƒm, Ä‘Ã¡nh giÃ¡, pháº£n há»“i chatbot

Quáº£n trá»‹ viÃªn (Admin):

Quáº£n lÃ½ Ä‘á»‹a Ä‘iá»ƒm, ngÆ°á»i dÃ¹ng

Gáº¯n tháº» ngá»¯ nghÄ©a (semantic tags)

Cáº¥u hÃ¬nh & huáº¥n luyá»‡n AI (prompt, few-shot, feedback)

ğŸ§  Äiá»ƒm ná»•i báº­t cá»§a HANOIGO

AI hiá»ƒu ngá»¯ cáº£nh, khÃ´ng chá»‰ lá»c dá»¯ liá»‡u

Semantic Enrichment giÃºp AI â€œhiá»ƒuâ€ Ä‘á»‹a Ä‘iá»ƒm (mood, khÃ´ng gian, má»©c Ä‘á»™ phÃ¹ há»£p)

Feedback Loop giÃºp há»‡ thá»‘ng ngÃ y cÃ ng thÃ´ng minh

Admin cÃ³ thá»ƒ huáº¥n luyá»‡n AI khÃ´ng cáº§n code

âœ… Káº¿t luáº­n ngáº¯n

HANOIGO lÃ  má»™t há»‡ thá»‘ng káº¿t há»£p giá»¯a:

Web Application + CÆ¡ sá»Ÿ dá»¯ liá»‡u ngá»¯ nghÄ©a + AI Chatbot cÃ¡ nhÃ¢n hÃ³a

Giáº£i phÃ¡p nÃ y giÃºp:

Giáº£m thá»i gian tÃ¬m kiáº¿m

TÄƒng Ä‘á»™ chÃ­nh xÃ¡c gá»£i Ã½

Dá»… má»Ÿ rá»™ng vÃ  cáº£i tiáº¿n trong tÆ°Æ¡ng lai
1) Collection: users (NgÆ°á»i dÃ¹ng)

Má»¥c Ä‘Ã­ch: lÆ°u tÃ i khoáº£n ngÆ°á»i dÃ¹ng vÃ  há»“ sÆ¡ sá»Ÿ thÃ­ch Ä‘á»ƒ cÃ¡ nhÃ¢n hÃ³a gá»£i Ã½.

Fields tiÃªu biá»ƒu:

_id: ObjectId

role: user

email: string (unique)
avatarUrl: String, // â† URL Cloudinary

password: string (Ä‘Ã£ hash)

displayName: string

avatarUrl: string

createdAt: date

isBanned: boolean

Preferences (cá»±c quan trá»ng cho AI):

preferences: object

favoriteFoods: [string] (vd: â€œláº©uâ€, â€œnÆ°á»›ngâ€, â€œcafeâ€)

styles: [string] (vd: â€œyÃªn tÄ©nhâ€, â€œsang trá»ngâ€, â€œvintageâ€)

dietary: [string] (vd: â€œvegetarianâ€, â€œeat-cleanâ€, â€œkhÃ´ng cayâ€)

2) Collection: admins (Quáº£n trá»‹ viÃªn)

Má»¥c Ä‘Ã­ch: quáº£n lÃ½ há»‡ thá»‘ng + dá»¯ liá»‡u + cáº¥u hÃ¬nh/huáº¥n luyá»‡n AI.

Fields tiÃªu biá»ƒu:

_id: ObjectId

role: admin

username: string (unique)

password: string (Ä‘Ã£ hash)

displayName: string

role: string (vd: â€œsuperAdminâ€, â€œeditorâ€)

permissions: [string] (vd: â€œplaces.createâ€, â€œplaces.updateâ€, â€œai.tuneâ€)

lastLogin: date

3) Collection: places (Äá»‹a Ä‘iá»ƒm)

Má»¥c Ä‘Ã­ch: â€œkho kiáº¿n thá»©c trung tÃ¢mâ€ cho há»‡ thá»‘ng search + RAG chatbot.

Fields tiÃªu biá»ƒu:

_id: ObjectId

name: string

address: string

district: string (khuyáº¿n nghá»‹ thÃªm Ä‘á»ƒ lá»c theo quáº­n/huyá»‡n)

category: string (â€œÄ‚n uá»‘ngâ€ / â€œVui chÆ¡iâ€ / â€¦)

description: string

priceRange: object

min: number

max: number

images: [string] (URL Cloudinary)

menu: [object] (tuá»³ mÃ´ hÃ¬nh, vÃ­ dá»¥: {name, price})

AI Semantic Tags (lÃ m giÃ u ngá»¯ nghÄ©a):

aiTags: object

space: [string] (vd: â€œáº¥m cÃºngâ€, â€œngoÃ i trá»iâ€)

mood: [string] (vd: â€œlÃ£ng máº¡nâ€, â€œchillâ€, â€œsÃ´i Ä‘á»™ngâ€)

suitability: [string] (vd: â€œháº¹n hÃ²â€, â€œhá»c bÃ iâ€, â€œtá»¥ táº­pâ€)

(cÃ³ thá»ƒ má»Ÿ rá»™ng thÃªm: â€œcrowdLevelâ€, â€œmusicâ€, â€œviewâ€...)

4) Collection: reviews (ÄÃ¡nh giÃ¡)

Má»¥c Ä‘Ã­ch: táº¡o cá»™ng Ä‘á»“ng review + lÃ  dá»¯ liá»‡u feedback giÃºp AI cáº£i thiá»‡n.

Fields tiÃªu biá»ƒu:

_id: ObjectId

userId: ObjectId (ref users._id)

placeId: ObjectId (ref places._id)

rating: number (1â€“5)

comment: string

createdAt: date

Gá»£i Ã½ má»Ÿ rá»™ng (náº¿u muá»‘n máº¡nh hÆ¡n):

images: [string] (áº£nh review)

tags: [string] (vd: â€œÄ‘á»“ ngonâ€, â€œphá»¥c vá»¥ tá»‘tâ€, â€œgiÃ¡ caoâ€)
---

## ğŸ“ Cáº¤U TRÃšC BACKEND - HANOIGO

### ğŸ¯ Kiáº¿n trÃºc tá»•ng quan

Backend HANOIGO tuÃ¢n theo kiáº¿n trÃºc **MVC (Model-View-Controller)** vá»›i **Service Layer** tÃ¡ch biá»‡t, Ä‘áº£m báº£o:

- **Separation of Concerns**: Má»—i layer cÃ³ trÃ¡ch nhiá»‡m riÃªng biá»‡t
- **Testability**: Dá»… dÃ ng unit test tá»«ng layer
- **Scalability**: Dá»… má»Ÿ rá»™ng vÃ  maintain
- **Reusability**: Business logic cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng

### ğŸ“Š Luá»“ng xá»­ lÃ½ Request

```
Request â†’ Route â†’ Middleware â†’ Controller â†’ Service â†’ Model â†’ Database
                                    â†“           â†“
                                Response â† Data Processing
```

---

## ğŸ“‚ Cáº¥u trÃºc thÆ° má»¥c Server

```
server/
â”œâ”€â”€ server.js                    # Entry point - khá»Ÿi táº¡o Express server
â”œâ”€â”€ package.json                 # Dependencies vÃ  scripts
â”‚
â”œâ”€â”€ config/                      # Cáº¥u hÃ¬nh mÃ´i trÆ°á»ng
â”‚   â”œâ”€â”€ db.js                   # MongoDB connection
â”‚   â””â”€â”€ cloudinary.js           # Cloudinary config
â”‚
â”œâ”€â”€ models/                      # MongoDB Schemas (Data Layer)
â”‚   â”œâ”€â”€ User.js                 # Schema ngÆ°á»i dÃ¹ng
â”‚   â”œâ”€â”€ Place.js                # Schema Ä‘á»‹a Ä‘iá»ƒm
â”‚   â”œâ”€â”€ Review.js               # Schema Ä‘Ã¡nh giÃ¡
â”‚   â””â”€â”€ Admin.js                # Schema quáº£n trá»‹ viÃªn
â”‚
â”œâ”€â”€ controllers/                 # HTTP Request Handlers (Controller Layer)
â”‚   â”œâ”€â”€ authController.js       # Xá»­ lÃ½ register/login/logout
â”‚   â”œâ”€â”€ userController.js       # Xá»­ lÃ½ user profile, preferences
â”‚   â”œâ”€â”€ placesController.js     # Xá»­ lÃ½ CRUD places, search
â”‚   â”œâ”€â”€ reviewController.js     # Xá»­ lÃ½ CRUD reviews
â”‚   â”œâ”€â”€ chatController.js       # Xá»­ lÃ½ AI chatbot interactions
â”‚   â”œâ”€â”€ uploadController.js     # Xá»­ lÃ½ upload áº£nh (Cloudinary)
â”‚   â””â”€â”€ adminController.js      # Xá»­ lÃ½ admin operations
â”‚
â”œâ”€â”€ services/                    # Business Logic Layer â­ QUAN TRá»ŒNG
â”‚   â”œâ”€â”€ authService.js          # Logic authentication, JWT, OAuth
â”‚   â”œâ”€â”€ userService.js          # Logic quáº£n lÃ½ user, preferences
â”‚   â”œâ”€â”€ placeService.js         # Logic tÃ¬m kiáº¿m, filter, semantic search
â”‚   â”œâ”€â”€ reviewService.js        # Logic tÃ­nh rating, validate review
â”‚   â”œâ”€â”€ chatService.js          # Logic RAG, vector search, AI prompt
â”‚   â”œâ”€â”€ uploadService.js        # Logic xá»­ lÃ½ áº£nh, resize, optimize
â”‚   â””â”€â”€ emailService.js         # Logic gá»­i email (náº¿u cÃ³)
â”‚
â”œâ”€â”€ middleware/                  # Express Middlewares
â”‚   â”œâ”€â”€ auth.js                 # Verify JWT, protect routes
â”‚   â”œâ”€â”€ errorHandler.js         # Global error handling
â”‚   â”œâ”€â”€ notFound.js             # 404 handler
â”‚   â”œâ”€â”€ validate.js             # Request validation (Joi/express-validator)
â”‚   â””â”€â”€ upload.js               # Multer config cho file upload
â”‚
â”œâ”€â”€ routes/                      # API Route Definitions
â”‚   â”œâ”€â”€ authRoutes.js           # /api/auth/*
â”‚   â”œâ”€â”€ userRoutes.js           # /api/users/*
â”‚   â”œâ”€â”€ placeRoutes.js          # /api/places/*
â”‚   â”œâ”€â”€ reviewRoutes.js         # /api/reviews/*
â”‚   â”œâ”€â”€ chatRoutes.js           # /api/chat/*
â”‚   â”œâ”€â”€ adminRoutes.js          # /api/admin/*
â”‚   â””â”€â”€ aiRoutes.js             # /api/ai/* (AI config, feedback)
â”‚
â”œâ”€â”€ utils/                       # Helper Functions
â”‚   â”œâ”€â”€ asyncHandler.js         # Wrap async controllers (error handling)
â”‚   â”œâ”€â”€ validators.js           # Custom validation functions
â”‚   â”œâ”€â”€ formatters.js           # Data formatting utilities
â”‚   â””â”€â”€ constants.js            # App constants (districts, categories)
â”‚
â””â”€â”€ uploads/                     # Temporary file storage
    â””â”€â”€ avatars/                # Avatar uploads trÆ°á»›c khi lÃªn Cloudinary
```

---

## âš™ï¸ KIáº¾N TRÃšC CONTROLLER - SERVICE - MODEL

### ğŸ¯ NguyÃªn táº¯c phÃ¢n chia trÃ¡ch nhiá»‡m

#### 1ï¸âƒ£ **Controller Layer** (controllers/)

**Chá»©c nÄƒng:**
- Nháº­n HTTP request, extract params/body/query
- Validate input cÆ¡ báº£n (gá»i middleware hoáº·c validator)
- Gá»i Service layer Ä‘á»ƒ xá»­ lÃ½ business logic
- Format response vÃ  tráº£ vá» cho client
- **KHÃ”NG chá»©a business logic phá»©c táº¡p**

**âœ… Controller KHÃ”NG lÃ m gÃ¬:**
- KhÃ´ng query database trá»±c tiáº¿p
- KhÃ´ng xá»­ lÃ½ logic phá»©c táº¡p (filter, calculate, transform data)
- KhÃ´ng gá»i external APIs
- KhÃ´ng validate business rules

---

#### 2ï¸âƒ£ **Service Layer** (services/) â­ CORE BUSINESS LOGIC

**Chá»©c nÄƒng:**
- Chá»©a toÃ n bá»™ business logic cá»§a á»©ng dá»¥ng
- Xá»­ lÃ½ data transformation, filtering, sorting
- Validate business rules (vÃ­ dá»¥: user khÃ´ng thá»ƒ review cÃ¹ng 1 place 2 láº§n)
- Gá»i Model Ä‘á»ƒ thao tÃ¡c database
- Gá»i external APIs (OpenAI, Cloudinary, Email service)
- CÃ³ thá»ƒ gá»i Service khÃ¡c (composition)

*
```

**âœ… Service lÃ m gÃ¬:**
- Query database thÃ´ng qua Model
- Validate business rules
- Transform data
- Orchestrate complex operations (gá»i nhiá»u Models/Services)
- Handle external API calls

**âŒ Service KHÃ”NG lÃ m gÃ¬:**
- KhÃ´ng xá»­ lÃ½ HTTP request/response
- KhÃ´ng biáº¿t vá» req, res objects
- KhÃ´ng format JSON response

---

#### 3ï¸âƒ£ **Model Layer** (models/)

**Chá»©c nÄƒng:**
- Define MongoDB schema
- Define virtual fields, methods, statics
- Pre/post hooks (middleware)
- Data validation táº¡i DB level
- **Chá»‰ tÆ°Æ¡ng tÃ¡c vá»›i database**





## âœ… TÃ“M Táº®T NGUYÃŠN Táº®C

| Layer | TrÃ¡ch nhiá»‡m | VÃ­ dá»¥ code |
|-------|-------------|------------|
| **Route** | Define endpoints, apply middleware | `router.post('/places', protect, createPlace)` |
| **Middleware** | Authentication, validation, error handling | `auth.js`, `validate.js` |
| **Controller** | Handle HTTP, call Service, format response | `const result = await placeService.getPlaces(filters)` |
| **Service** | Business logic, orchestrate operations | `const place = await Place.findById(id)` |
| **Model** | Database schema, validation, indexes | `placeSchema.pre('save', ...)` |

**ğŸ¯ Quy táº¯c vÃ ng:**
- Controller â†’ gá»i Service
- Service â†’ gá»i Model
- Model â†’ tÆ°Æ¡ng tÃ¡c Database
- **KHÃ”NG BAO GIá»œ**: Controller gá»i Model trá»±c tiáº¿p

**âœ¨ Lá»£i Ã­ch:**
- **Testable**: Dá»… viáº¿t unit test cho tá»«ng layer
- **Maintainable**: Thay Ä‘á»•i business logic khÃ´ng áº£nh hÆ°á»Ÿng Controller
- **Reusable**: Service cÃ³ thá»ƒ dÃ¹ng láº¡i á»Ÿ nhiá»u Controller
- **Scalable**: Dá»… má»Ÿ rá»™ng vÃ  refactor